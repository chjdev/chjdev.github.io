---
title: The k-Means Algorithm Visualized
description: Visualizing the iterations of the k-means algorithm.
published: false
layout: post
---

<!--
The full ECMAScript code can be found
[here](/assets/2016/01/kmeans.es) or viewed directly on
[Github](https://github.com/chjdev/chjdev.github.io/tree/master/assets/2016/01/kmeans.es).
A transpiled version using [Babel](https://babeljs.io) can be found
[here](/assets/2016/01/kmeans.js).
-->

<script src='/assets/2016/01/murmurhash2.js' />
<script>

// TODO wrap in class
const 
      k = 5, // 5-bit buckets are enough for cardinalities up to 10^11
      m = Math.pow(2, k),
      H = 32,
      estimators = new Array(m),
      alpha_m = 0.39701;
estimators.fill(0);

function add(value) {
    hashed = hash(value)
    bucket = getBits(hashed, 0, k)
    estimators[bucket] = Math.max(estimators[bucket], rank(getBits(hashed, k, H)));
}

function hash(value) {
    return doHash(value.toString(), 123);
}

function get_bits(value, start, end) {
    return (value << start) >> (start + (k - end) - 1);
}

function rank(value) {
    return 1 + k - Math.floor(Math.log(value) / Math.LN2 )
}

function estimate() {
    return alpha_m * m * Math.pow(2, 1/m * estimators.reduce((a, b) => a + b));
}


const timeout = 1000,
      visitors = 10e6;
var total_visits = 0;

function gen_visit(visitors) {
    return Math.floor((1 - Math.pow(Math.random(), 2)) * visitors);
}

for (;;total_visits++) {
    add(gen_visit());
}

function analyze() {
    console.log(total_visits, estimate());
}
setInterval(analyze, 1000);
 
</script>

